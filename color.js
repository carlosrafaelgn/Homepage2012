"use strict";window.ColorUtils={rgbToHSV:function(d){var i=((d>>>16)&255)/255,h=((d>>>8)&255)/255,c=(d&255)/255,a=Math.max(i,h,c),f=Math.min(i,h,c),e={h:0,s:((a===0)?0:((a-f)/a)),v:a};if(a!==f){if(a===i){if(h>=c){e.h=(60*((h-c)/(a-f)))/360}else{e.h=((60*((h-c)/(a-f)))+360)/360}}else{if(a===h){e.h=((60*((c-i)/(a-f)))+120)/360}else{e.h=((60*((i-h)/(a-f)))+240)/360}}}return e},hsvToRGB:function(d){var i=6*d.h,f=d.s,c=d.v*255,e,k,j,a;if(i>5.99){i=0}e=(i|0)%6;i-=e;k=c*(1-f);j=c*(1-(i*f));a=c*(1-((1-i)*f));switch(e){case 1:a=k;k=j;j=c;break;case 2:j=c;break;case 3:a=c;break;case 4:j=k;k=a;a=c;break;case 5:a=j;j=k;k=c;break;default:j=a;a=k;k=c;break}return(((k>=255)?255:(k|0))<<16)|(((j>=255)?255:(j|0))<<8)|((a>=255)?255:(a|0))},brightness:function(a){return((19595*((a>>>16)&255))+(38470*((a>>>8)&255))+(7471*(a&255)))>>>16},bwForRGB:function(a){return(ColorUtils.brightness(a)<100?16777215:0)},rgbToGray:function(b){var a=ColorUtils.brightness(b);return(a<<16)|(a<<8)|a},hexColor:function(a){var b=(a&16777215).toString(16);if(b.length<6){b="00000"+b;return b.substr(b.length-6,6)}return b},relativeLuminance:function(a){var c=((a>>>16)&255)/255,b=((a>>>8)&255)/255,f=(a&255)/255,e,d,g;if(c<=0.03928){e=c/12.92}else{e=Math.pow((c+0.055)/1.055,2.4)}if(b<=0.03928){d=b/12.92}else{d=Math.pow((b+0.055)/1.055,2.4)}if(f<=0.03928){g=f/12.92}else{g=Math.pow((f+0.055)/1.055,2.4)}return(0.2126*e)+(0.7152*d)+(0.0722*g)},contrastRatioL:function(a,b){return(a>=b)?((a+0.05)/(b+0.05)):((b+0.05)/(a+0.05))},contrastRatio:function(b,a){return ColorUtils.contrastRatioL(ColorUtils.relativeLuminance(b),ColorUtils.relativeLuminance(a))}};freeze$(window.ColorUtils);function ColorChooserView(){var a,b,c;a=this;this.hidePopup=function(){a.isVisible=false;return true};this.colorChooserModel=null;this.isVisible=false;this.ignoreChanges=false;this.baseControl=null;this.color=0;this.lastX=0;this.lastY=0;this.isTd1=false;this.isDown=false;this.hsv={h:0,s:0,v:0};this.cc=document.createElement("div");this.cc.className="ITCONT FPOP _HID";if(!_isTouch){attachMouse(this.cc,"mousedown",ColorChooserView.prototype.cc_MouseDown)}this.cr1=document.createElement("div");this.cr1.style.position="absolute";this.cr1.style.zIndex=0;this.cr1.style.width="15px";this.cr1.style.height="15px";this.cr1.style.backgroundRepeat="no-repeat";this.cr1.style.backgroundImage=ColorChooserView._crossw;this.cr1c=16777215;this.cr2=document.createElement("div");this.cr2.style.position="absolute";this.cr2.style.zIndex=0;this.cr2.style.width="15px";this.cr2.style.height="15px";this.cr2.style.backgroundRepeat="no-repeat";this.cr2.style.backgroundImage=ColorChooserView._crossw;this.cr2.style.left="0px";this.cr2c=16777215;this.td1=document.createElement("div");this.cc.appendChild(this.td1);this.td2=document.createElement("div");this.cc.appendChild(this.td2);this.td3=document.createElement("div");this.cc.appendChild(this.td3);this.td1.style.display="inline-block";this.td1.style.position="relative";this.td1.style.margin="4px";this.td1.style.overflow="hidden";this.td1.style.zIndex=0;this.td1.style.cursor="crosshair";this.td1.style.width="128px";this.td1.style.height="128px";this.td1.style.border="1px solid #518ec2";this.td1.style.backgroundRepeat="no-repeat";this.td1.style.backgroundColor="#ff0000";this.td1.style.backgroundImage='url("/Images/colorchooser.png")';this.td1.style.verticalAlign="middle";this.td1.appendChild(this.cr1);this.td2.style.display="inline-block";this.td2.style.position="relative";this.td2.style.margin="4px 0px";this.td2.style.overflow="hidden";this.td2.style.zIndex=0;this.td2.style.cursor="crosshair";this.td2.style.width="20px";this.td2.style.height="128px";this.td2.style.border="1px solid #518ec2";this.td2.style.backgroundRepeat="repeat-x";this.td2.style.backgroundImage='url("/Images/colorchooserhue.png")';this.td2.style.verticalAlign="middle";this.td2.appendChild(this.cr2);this.td3.style.display="inline-block";this.td3.style.position="relative";this.td2.style.margin="4px";this.td3.style.border="1px solid transparent";this.td3.style.verticalAlign="middle";this.td3.style.marginRight="4px";this.nudH=new NumericUpDown(0,360,0,true);this.nudS=new NumericUpDown(0,100,0,false);this.nudV=new NumericUpDown(0,100,0,false);c=document.createElement("div");c.style.display="inline-block";c.style.marginBottom="4px";b=Elem.createLabel("H:",c);b.style.width=Elem.em2spx(1.5);this.nudH.createControl(5.5,3,c);this.td3.appendChild(c);Elem.br(this.td3);c=document.createElement("div");c.style.display="inline-block";c.style.marginBottom="4px";b=Elem.createLabel("S:",c);b.style.width=Elem.em2spx(1.5);this.nudS.createControl(5.5,3,c);this.td3.appendChild(c);Elem.br(this.td3);c=document.createElement("div");c.style.display="inline-block";b=Elem.createLabel("V:",c);b.style.width=Elem.em2spx(1.5);this.nudV.createControl(5.5,3,c);this.td3.appendChild(c);this.td1.colorChooserView=this;attachMouse(this.td1,"mousedown",ColorChooserView.prototype.td1_MouseDown);this.td2.colorChooserView=this;attachMouse(this.td2,"mousedown",ColorChooserView.prototype.td2_MouseDown);this.nudH.onValueChanged.attach(ColorChooserView.prototype.nudChanged,this);this.nudS.onValueChanged.attach(ColorChooserView.prototype.nudChanged,this);this.nudV.onValueChanged.attach(ColorChooserView.prototype.nudChanged,this);document.body.appendChild(this.cc);this.document_MouseMove=function(d){return(a.isTd1?a.td1_Changed(d.pageX,d.pageY):a.td2_Changed(d.pageY))};this.document_MouseUp=function(d){a.isDown=false;detachMouse(document,"mousemove",a.document_MouseMove,true);detachMouse(document,"mouseup",a.document_MouseUp,true);return true};seal$(this)}ColorChooserView._crossb="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAYAAAA71pVKAAAAAXNSR0IArs4c6QAAACtJREFUKM9jYMAN/qPRGICJgQIwEjWz4AtNLCFPPcBIwFRGcm0dTSTU1gwA8T0IE7kJHVEAAAAASUVORK5CYII=)";ColorChooserView._crossw="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAYAAAA71pVKAAAAAXNSR0IArs4c6QAAADFJREFUKM9jYMAB/v///x+ZxgaYGCgAI1EzC77QRA95qgJGfKYyMjIykmXraCKhgWYAYEcf/tBAPdMAAAAASUVORK5CYII=)";ColorChooserView.prototype={td1_Changed:function(a,c){var b=Elem.leftTop(this.td1);b[0]=a-b[0]-2;b[1]=c-b[1]-2;if(b[0]<0){b[0]=0}else{if(b[0]>127){b[0]=127}}if(b[1]<0){b[1]=0}else{if(b[1]>127){b[1]=127}}this.hsv.s=(127-b[1])/127;this.hsv.v=b[0]/127;this.color=ColorUtils.hsvToRGB(this.hsv);this.refreshNuds();this.refreshCrosses();this.ignoreChanges=true;this.colorChooserModel.setColor(this.color);this.ignoreChanges=false;return true},td2_Changed:function(b){var a=Elem.leftTop(this.td2);a[1]=b-a[1]-2;if(a[1]<0){a[1]=0}else{if(a[1]>127){a[1]=127}}this.hsv.h=(127-a[1])/127;this.color=ColorUtils.hsvToRGB(this.hsv);this.refreshBg();this.refreshNuds();this.refreshCrosses();this.ignoreChanges=true;this.colorChooserModel.setColor(this.color);this.ignoreChanges=false;return true},cc_MouseDown:function(b){if(!b.button){var a=b.target;return((a===this||a.tagName.toLowerCase()!=="input")?cancelEvent(b):true)}return true},td1_MouseDown:function(b){var a=this.colorChooserView;if(!b.button&&!a.isDown){a.isDown=true;a.isTd1=true;attachMouse(document,"mousemove",a.document_MouseMove,true);attachMouse(document,"mouseup",a.document_MouseUp,true);a.td1_Changed(b.pageX,b.pageY);return cancelEvent(b)}return true},td2_MouseDown:function(b){var a=this.colorChooserView;if(!b.button&&!a.isDown){a.isDown=true;a.isTd1=false;attachMouse(document,"mousemove",a.document_MouseMove,true);attachMouse(document,"mouseup",a.document_MouseUp,true);a.td2_Changed(b.pageY);return cancelEvent(b)}return true},refreshBg:function(){this.td1.style.backgroundColor="#"+ColorUtils.hexColor(ColorUtils.hsvToRGB({h:this.hsv.h,s:1,v:1}));return true},refreshNuds:function(){var a=this.ignoreChanges;this.ignoreChanges=true;this.nudH.setValue(Math.floor(360*this.hsv.h));this.nudS.setValue(Math.floor(100*this.hsv.s));this.nudV.setValue(Math.floor(100*this.hsv.v));this.ignoreChanges=a;return true},refreshCrosses:function(){var a=ColorUtils.bwForRGB(this.color);if(a!==this.cr1c){this.cr1.style.backgroundImage=(a?ColorChooserView._crossw:ColorChooserView._crossb);this.cr1c=a}a=ColorUtils.bwForRGB(ColorUtils.hsvToRGB({h:this.hsv.h,s:1,v:1}));if(a!==this.cr2c){this.cr2.style.backgroundImage=(a?ColorChooserView._crossw:ColorChooserView._crossb);this.cr2c=a}this.cr1.style.left=(-7+((this.hsv.v*127)|0))+"px";this.cr1.style.top=(-7+127-((this.hsv.s*127)|0))+"px";this.cr2.style.top=(-7+127-((this.hsv.h*127)|0))+"px";return true},nudChanged:function(){if(!this.ignoreChanges){var a=this.hsv.h;this.hsv.h=this.nudH.getValue()/360;this.hsv.s=this.nudS.getValue()/100;this.hsv.v=this.nudV.getValue()/100;if(this.hsv.h!==a){this.refreshBg()}this.color=ColorUtils.hsvToRGB(this.hsv);this.refreshCrosses();this.ignoreChanges=true;this.colorChooserModel.setColor(this.color);this.ignoreChanges=false}return true},colorChanged:function(b,a){if(!this.ignoreChanges){this.color=a;this.hsv=ColorUtils.rgbToHSV(a);this.refreshBg();this.refreshNuds();this.refreshCrosses()}return true},show:function(a,b){if(this.isVisible){this.hide()}if(this.colorChooserModel!==a){if(this.colorChooserModel){this.colorChooserModel.onColorChanged.detachFunction(ColorChooserView.prototype.colorChanged)}this.colorChooserModel=a;a.onColorChanged.attach(ColorChooserView.prototype.colorChanged,this)}this.colorChanged(a,a.getColor());this.isVisible=true;this.baseControl=b;FloatingPopup.show(this.cc,b,this.hidePopup,false,true,true,true,true);this.refreshCrosses();return true},hide:function(){if(this.isVisible){FloatingPopup.close()}return true}};freeze$(ColorChooserView.prototype);function ColorChooser(){this._color=0;this.onColorChanged=new ObserverList()}ColorChooser._control=null;ColorChooser._controller=null;ColorChooser.prototype={getColor:function(){return this._color},setColor:function(a){if(a!==this._color){this._color=a;this.onColorChanged.notify(this,a)}return a},isVisible:function(){return((ColorChooser._controller===this)&&ColorChooser._control&&ColorChooser._control.isVisible)},show:function(a){if(ColorChooser._control===null){ColorChooser._control=new ColorChooserView()}ColorChooser.prototype.hide();ColorChooser._controller=this;return ColorChooser._control.show(this,a)},hide:function(){if(ColorChooser._controller){ColorChooser._control.hide();ColorChooser._controller=null}return true}};seal$(ColorChooser.prototype);